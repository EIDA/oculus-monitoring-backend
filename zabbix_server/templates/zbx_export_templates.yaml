zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 44950db14d8549c2a022ab3d5ba3ff96
      name: Templates/EIDA
  host_groups:
    - uuid: 538a19975c7a43cf8a349b953d587723
      name: 'EIDA nodes'
  templates:
    - uuid: 74f0d2bd954841d39f19a0c7d06549ee
      template: 'Template discovery'
      name: 'Template discovery'
      description: 'Template for discovery agent/host'
      groups:
        - name: Templates/EIDA
      discovery_rules:
        - uuid: 73a97a466ed542a98a67e3e2c61af74a
          name: EIDA_ENDPOINT
          key: eida.lld
          host_prototypes:
            - uuid: 357b595cf81e44a8a70842dbd8887fdd
              host: '{#EIDA_WS_ENDPOINT}'
              name: '{#EIDA_NODE}'
              group_links:
                - group:
                    name: 'EIDA nodes'
              templates:
                - name: 'Template webservices'
                - name: 'Website certificate by Zabbix agent 2'
              macros:
                - macro: '{$CERT.EXPIRY.WARN}'
                  value: '14'
                  description: 'Number of days until the certificate expires.'
                - macro: '{$CERT.WEBSITE.HOSTNAME}'
                  value: '{#EIDA_WS_ENDPOINT}'
                - macro: '{$EIDA_CHANNEL}'
                  value: '{#EIDA_CHANNEL}'
                  description: 'EIDA channel'
                - macro: '{$EIDA_ENDTIME}'
                  value: '{#EIDA_ENDTIME}'
                  description: 'EIDA end time'
                - macro: '{$EIDA_LOCATION}'
                  value: '{#EIDA_LOCATION}'
                  description: 'EIDA location'
                - macro: '{$EIDA_NETWORK}'
                  value: '{#EIDA_NETWORK}'
                  description: 'EIDA network'
                - macro: '{$EIDA_NODE}'
                  value: '{#EIDA_NODE}'
                  description: 'EIDA nodes name'
                - macro: '{$EIDA_ROUTING_FILE}'
                  value: '{#EIDA_ROUTING_FILE}'
                  description: 'location of the static routing file'
                - macro: '{$EIDA_STARTTIME}'
                  value: '{#EIDA_STARTTIME}'
                  description: 'EIDA start time'
                - macro: '{$EIDA_STATION}'
                  value: '{#EIDA_STATION}'
                  description: 'EIDA station'
                - macro: '{$EIDA_WS_ENDPOINT}'
                  value: '{#EIDA_WS_ENDPOINT}'
                  description: 'EIDA nodes address'
    - uuid: b192614a2cbc490eb3ca047e9eb36328
      template: 'Template webservices'
      name: 'Template webservices'
      groups:
        - name: Templates/EIDA
      httptests:
        - uuid: 32b3e3d018b2423c899d92878cbe3567
          name: availability
          steps:
            - name: 'get documentation'
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/availability/1/'
              follow_redirects: 'NO'
              retrieve_mode: HEADERS
              status_codes: '200'
            - name: 'simple request'
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/availability/1/query'
              query_fields:
                - name: net
                  value: '{$EIDA_NETWORK}'
                - name: sta
                  value: '{$EIDA_STATION}'
                - name: loc
                  value: '{$EIDA_LOCATION}'
                - name: cha
                  value: '{$EIDA_CHANNEL}'
                - name: start
                  value: '{$EIDA_STARTTIME}'
                - name: end
                  value: '{$EIDA_ENDTIME}'
              retrieve_mode: HEADERS
              status_codes: '200'
            - name: application.wadl
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/availability/1/application.wadl'
              follow_redirects: 'NO'
              required: wadl.dev.java.net
              status_codes: '200'
          tags:
            - tag: Application
              value: fdsn
        - uuid: dfcb1e93f5c9489598c189e82f523833
          name: dataselect
          steps:
            - name: 'dataselect accessible'
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/dataselect/1/'
              status_codes: '200'
            - name: 'dataselect short request'
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/dataselect/1/query'
              query_fields:
                - name: net
                  value: '{$EIDA_NETWORK}'
                - name: sta
                  value: '{$EIDA_STATION}'
                - name: cha
                  value: '{$EIDA_CHANNEL}'
                - name: start
                  value: '{$EIDA_STARTTIME}'
                - name: end
                  value: '{$EIDA_ENDTIME}'
                - name: nodata
                  value: '404'
              timeout: 60s
              status_codes: '200'
            - name: application.wadl
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/dataselect/1/application.wadl'
              follow_redirects: 'NO'
              required: wadl.dev.java.net
              status_codes: '200'
          tags:
            - tag: Application
              value: fdsn
        - uuid: 482c8b39cf3b4aca8dc9b7859373c210
          name: 'present in central eida routing'
          delay: 60m
          steps:
            - name: 'EIDA Routing infomation'
              url: 'https://www.orfeus-eu.org/eidaws/routing/1/query'
              query_fields:
                - name: service
                  value: station
                - name: network
                  value: '{$EIDA_NETWORK}'
              required: '{$EIDA_WS_ENDPOINT}'
              status_codes: '200'
          tags:
            - tag: Application
              value: routing
        - uuid: d3a4a789f3ee42ec8418b6e5044c8804
          name: 'routing information published at node'
          delay: 15m
          steps:
            - name: 'eida routing XML file'
              url: 'https://{$EIDA_WS_ENDPOINT}/routing/eida_routing.xml'
              follow_redirects: 'NO'
              required: 'ns0:route networkCode="{$EIDA_NETWORK}"'
              status_codes: '200'
          tags:
            - tag: Application
              value: eidaws
        - uuid: 81e6f10b63214e2cba9dbe5fabd2626e
          name: station
          delay: 5m
          steps:
            - name: documentation
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/station/1/'
              follow_redirects: 'NO'
              status_codes: '200'
            - name: 'short request'
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/station/1/query'
              query_fields:
                - name: net
                  value: '{$EIDA_NETWORK}'
                - name: sta
                  value: '{$EIDA_STATION}'
                - name: loc
                  value: '{$EIDA_LOCATION}'
                - name: cha
                  value: '{$EIDA_CHANNEL}'
                - name: level
                  value: response
              timeout: 30s
              status_codes: '200'
            - name: application.wadl
              url: 'https://{$EIDA_WS_ENDPOINT}/fdsnws/station/1/application.wadl'
              follow_redirects: 'NO'
              required: wadl.dev.java.net
              status_codes: '200'
          tags:
            - tag: Application
              value: fdsn
        - uuid: a5d4964d6ad84e44829dbb8dddef25cc
          name: wfcatalog
          steps:
            - name: 'get documentation'
              url: 'https://{$EIDA_WS_ENDPOINT}/eidaws/wfcatalog/1/'
              follow_redirects: 'NO'
              retrieve_mode: HEADERS
              status_codes: '200'
            - name: 'simple query'
              url: 'https://{$EIDA_WS_ENDPOINT}/eidaws/wfcatalog/1/query'
              query_fields:
                - name: net
                  value: '{$EIDA_NETWORK}'
                - name: sta
                  value: '{$EIDA_STATION}'
                - name: loc
                  value: '{$EIDA_LOCATION}'
                - name: cha
                  value: '{$EIDA_CHANNEL}'
                - name: start
                  value: '{$EIDA_STARTTIME}'
                - name: end
                  value: '{$EIDA_ENDTIME}'
              status_codes: '200'
          tags:
            - tag: Application
              value: eidaws
      macros:
        - macro: '{$EIDA_WS_ENDPOINT}'
          value: '{#EIDA_WS_ENDPOINT}'
          description: 'EIDA node endpoint'
