zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 44950db14d8549c2a022ab3d5ba3ff96
      name: Templates/EIDA
  templates:
    - uuid: bd7e234e9843428694e3a69342571091
      template: 'Template routing'
      name: 'Template routing'
      groups:
        - name: Templates/EIDA
      items:
        - uuid: 801dc7c5ae3e446f91f9babff21c90a4
          name: 'Routing central'
          type: HTTP_AGENT
          key: routing.central
          delay: 1d
          value_type: TEXT
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.datacenters[?(@.name==''{$NODE}'')].name'
              error_handler: CUSTOM_VALUE
              error_handler_params: ERROR
          timeout: 30s
          url: 'https://www.orfeus-eu.org/eidaws/routing/1/globalconfig'
          query_fields:
            - name: format
              value: fdsn
          headers:
            - name: Accept
              value: application/json
            - name: Content-Type
              value: application/json
            - name: User-Agent
              value: oculus-monitor
          tags:
            - tag: format
              value: json
            - tag: routing
              value: central
          triggers:
            - uuid: 5a0bf9b2fcbc437eb399f0683dcfb95e
              expression: 'last(/Template routing/routing.central)="ERROR"'
              name: 'EIDA central rouging node not present'
              priority: WARNING
              description: |
                The node is not present in EIDA central routing here:
                https://www.orfeus-eu.org/eidaws/routing/1/globalconfig?format=fdsn
              manual_close: 'YES'
        - uuid: ec644c6f926642f8b2d76db892f33316
          name: 'Routing central count datasets'
          type: HTTP_AGENT
          key: routing.central_datasets
          delay: 1d
          value_type: TEXT
          trends: '0'
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.datacenters[?(@.name == ''{$NODE}'')].repositories[?(@.name == ''archive'')].datasets.first().length()'
              error_handler: CUSTOM_VALUE
              error_handler_params: '0'
          timeout: 1m
          url: 'https://www.orfeus-eu.org/eidaws/routing/1/globalconfig'
          query_fields:
            - name: format
              value: fdsn
          headers:
            - name: Accept
              value: application/json
            - name: Content-Type
              value: application/json
            - name: User-Agent
              value: oculus-monitor
          tags:
            - tag: format
              value: json
            - tag: routing
              value: central_datasets
          triggers:
            - uuid: 535e10a824c849a8a4e6ae79c0066730
              expression: 'change(/Template routing/routing.central_datasets)<0'
              recovery_mode: RECOVERY_EXPRESSION
              recovery_expression: 'change(/Template routing/routing.central_datasets)>0'
              name: 'EIDA central routing lost at least one network for node {$NODE}'
              priority: AVERAGE
              description: |
                Central routing system advertises less networks than before (now : {ITEM.LASTVALUE}
                check the full information : https://www.orfeus-eu.org/eidaws/routing/1/globalconfig?format=fdsn
              manual_close: 'YES'
